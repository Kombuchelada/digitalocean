---
- name: Configure Infrastructure
  hosts: proxy_host
  become: true
  vars:
    volume_device: /dev/disk/by-id/scsi-0DO_Volume_docker-data-volume
    mount_path: /mnt/docker-data
    legacy_mount_path: /mnt/docker_data_volume
    docker_dir: "{{ mount_path }}/docker"
    services_dir: "{{ mount_path }}/services"
    npm_mount_path: "{{ mount_path }}/npm"
    npm_dirs:
      - "{{ services_dir }}/npm/data"
      - "{{ services_dir }}/npm/letsencrypt"
    npm_db_dir: "{{ services_dir }}/npm/db"
    npm_uid: 1000
    npm_gid: 1000
    mariadb_uid: 999
    mariadb_gid: 999
    pelican_mount_path: "{{ mount_path }}/pelican"
    pelican_dirs:
      - "{{ services_dir }}/pelican/var"
      - "{{ services_dir }}/pelican/nginx"
      - "{{ services_dir }}/pelican/certs"
      - "{{ services_dir }}/pelican/logs"
    pelican_db_dir: "{{ services_dir }}/pelican/db"
    stashapp_mount_path: "{{ mount_path }}/stashapp"
  tasks:
    - name: Include volume setup
      ansible.builtin.include_tasks: volume.yml
    - name: Include Docker installation
      ansible.builtin.include_tasks: docker.yml

    - name: Include Nginx Proxy Manager deployment
      ansible.builtin.include_tasks: services/nginx-proxy-manager/deploy.yml

    - name: Include Pelican Game Server deployment
      ansible.builtin.include_tasks: services/pelican/deploy.yml

    - name: Include Stashapp deployment
      ansible.builtin.include_tasks: services/stashapp/deploy.yml
